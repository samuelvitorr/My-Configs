##### =========================
##### Prefix (Ctrl+s)
##### =========================
set -g prefix C-s
unbind C-b
unbind r
bind r source-file ~/.tmux.conf \; display-message "üåÄ Configura√ß√£o do TMUX recarregada..."

bind C-l run-shell "tmux list-window -a -F '#S:#I #W' \
  | fzf --tmux center --prompt='Óûï Janelas: ' \
  | awk '{print \$1}' \
  | xargs tmux switch-client -t"

##### =========================
##### Popups (prefix + Ctrl + tecla)
##### =========================

# Notas tempor√°rias
bind-key C-n display-popup -E -w 60% -h 60% "nvim /tmp/scratch.md"

# Python REPL
bind-key C-p display-popup -E -w 60% -h 60% "python"

# htop
bind-key C-h display-popup -E -w 80% -h 80% "htop"

# Terminal tempor√°rio
bind-key C-t display-popup -E -w 80% -h 80% ""

# just run
bind-key C-x display-popup -w 80% -h 80% "just run"

##### =========================
##### Popup flutuante persistente (Toggle)
##### =========================
bind-key -r C-w run-shell "${HOME}/dotfiles/tmux/scripts/popup.sh float_popup term ${HOME}"

##### =========================
##### Terminal & Cores
##### =========================
set -g default-terminal "tmux-256color"
set -ga terminal-features ",xterm-ghostty:Tc"
set -as terminal-overrides ",xterm-256color:RGB,*256col*:RGB"
set -as terminal-features ',xterm-kitty:allow-passthrough'
set -g allow-passthrough on

##### =========================
##### Hist√≥rico & Atividade
##### =========================
set -g history-limit 30000
setw -g monitor-activity off
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off

##### =========================
##### √çndice base das janelas/panes
##### =========================
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

##### =========================
##### T√≠tulos das janelas
##### =========================
set -g set-titles on
set -g set-titles-string '#{?client_prefix,üÖøÔ∏è,} #S | #I:#W | #T'

##### =========================
##### Modo de c√≥pia (VI) + Clipboard
##### =========================
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -selection clipboard -in"

##### =========================
##### Mouse & Navega√ß√£o
##### =========================
set -g mouse on
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

##### =========================
##### Plugins (TPM)
##### =========================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# IMPORTANTE: O plugin de tema foi desativado para permitir a customiza√ß√£o manual "Bubble"
# set -g @plugin 'catppuccin/tmux'

##### =========================
##### Tema: Catppuccin Mocha (Configura√ß√£o Manual Bubble)
##### =========================
# Definindo as vari√°veis de cor manualmente j√° que removemos o plugin
set -g @catppuccin_bg "#1e1e2e"
set -g @catppuccin_fg "#cdd6f4"
set -g @catppuccin_red "#f38ba8"
set -g @catppuccin_green "#a6e3a1"
set -g @catppuccin_yellow "#f9e2af"
set -g @catppuccin_blue "#89b4fa"
set -g @catppuccin_mauve "#cba6f7"
set -g @catppuccin_peach "#fab387"
set -g @catppuccin_overlay0 "#6c7086"

# Separadores estilo bubble
set -g @bubble_sep_left "ÓÇ∂"
set -g @bubble_sep_right "ÓÇ¥"

##### =========================
##### Barra de Status (Bubble)
##### =========================
set -g status on
set -g status-interval 5
set -g status-justify centre
set -g status-position bottom
set -g status-left-length 60
set -g status-right-length 150
set -g status-style "bg=#{@catppuccin_bg},fg=#{@catppuccin_fg}"

# IMPORTANTE: Remove o separador padr√£o para as bolhas funcionarem corretamente
set -g window-status-separator ""

# Sess√£o (esquerda) - Adicionado @bubble_sep_left no in√≠cio
set -g status-left "#[fg=#{@catppuccin_blue},bg=#{@catppuccin_bg}]#{@bubble_sep_left}#[fg=#{@catppuccin_bg},bg=#{@catppuccin_blue},bold] #S #[fg=#{@catppuccin_blue},bg=#{@catppuccin_bg}]#{@bubble_sep_right}"

# Janelas (centro) - Adicionado espa√ßo no final para separa√ß√£o visual
setw -g window-status-format "#[fg=#{@catppuccin_overlay0},bg=#{@catppuccin_bg}]#{@bubble_sep_left}#[fg=#{@catppuccin_bg},bg=#{@catppuccin_overlay0}] #I:#W #[fg=#{@catppuccin_overlay0},bg=#{@catppuccin_bg}]#{@bubble_sep_right}  "
setw -g window-status-current-format "#[fg=#{@catppuccin_mauve},bg=#{@catppuccin_bg}]#{@bubble_sep_left}#[fg=#{@catppuccin_bg},bg=#{@catppuccin_mauve},bold] #I:#W #[fg=#{@catppuccin_mauve},bg=#{@catppuccin_bg}]#{@bubble_sep_right}  "

# Data e hostname (direita)
set -g status-right "#[fg=#{@catppuccin_peach},bg=#{@catppuccin_bg}]#{@bubble_sep_left}#[fg=#{@catppuccin_bg},bg=#{@catppuccin_peach}] %Y-%m-%d %H:%M #[fg=#{@catppuccin_peach},bg=#{@catppuccin_bg}]#{@bubble_sep_right} #[fg=#{@catppuccin_blue},bg=#{@catppuccin_bg}]#{@bubble_sep_left}#[fg=#{@catppuccin_bg},bg=#{@catppuccin_blue}] #h #[fg=#{@catppuccin_blue},bg=#{@catppuccin_bg}]#{@bubble_sep_right}"

##### =========================
##### Bordas dos Panes
##### =========================
set -g pane-border-style "fg=#{@catppuccin_overlay0}"
set -g pane-active-border-style "fg=#{@catppuccin_blue}"

##### =========================
##### Mensagens
##### =========================
set -g message-style "bg=#{@catppuccin_bg},fg=#{@catppuccin_fg}"
set -g message-command-style "bg=#{@catppuccin_bg},fg=#{@catppuccin_fg}"

##### =========================
##### Continuum & Resurrect
##### =========================
set -g @continuum-restore on
set -g @continuum-save-interval 10
set -g @resurrect-dir ~/.tmux/resurrect

##### =========================
##### Switch de janela com FZF (Ctrl+l)
##### =========================
bind C-l run-shell "tmux list-window -a -F '#S:#I #W' | fzf --sync --reverse --prompt='Óûï¬† Janelas: ' | awk '{print \$1}' | xargs tmux switch-client -t"

##### =========================
##### TPM (DEVE SEMPRE SER A √öLTIMA LINHA)
##### =========================
run '~/.tmux/plugins/tpm/tpm'
